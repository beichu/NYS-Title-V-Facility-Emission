# Load required libraries
library(pdftools)
library(stringr)

# NYS Title V emissions inventory data
""

# Define the PDF URL
pdf_url <- "https://www.dec.ny.gov/dardata/boss/afs/permits/128200035700002_r2.pdf"

# Download the PDF locally
setwd("C:/Users/Beibei/Desktop/Professional/Learn")
download.file(pdf_url, destfile = "permit.pdf", mode = "wb")

# Extract text from the PDF
pdf_text <- pdf_text("permit.pdf")

# Step 2: Combine all pages into one text block
full_text <- paste(pdf_text, collapse = "\n")

# Step 3: Define regex to extract chemical name and emission limit
# This targets blocks like: "Parameter Monitored: PARTICULATES\nUpper Permit Limit: 0.10 pounds per million Btus"
pattern <- "Parameter Monitored:\\s*(.*?)\\s*Upper Permit Limit:\\s*([0-9\\.]+)\\s*(percent by weight|percent|pounds per million Btus|lb/mmBtu|ppm|hours per year|minutes)"

# Step 4: Extract matches
matches <- str_match_all(full_text, pattern)[[1]]

# Step 5: Clean and format results
emission_limits <- data.frame(
    Chemical = matches[, 2],
    Limit = matches[, 3],
    Unit = matches[, 4],
    stringsAsFactors = FALSE
)
